<link rel="stylesheet" href="/style/form.css">
<script src="/javascript/scripts.js"></script>

<body>
    <%- include('../includes/navigation.ejs') %>

    <div class="container">
        <% if (errorMessage) { %>
            <div class="user-message user-message--error"><%= errorMessage %></div>
        <% } %>

        <h2>Añadir Nuevo Miembro</h2>
        <form action="/admin/<% if (editing) { %>edit<% } else { %>add<% } %>" method="post" enctype="multipart/form-data">

            <!-- Ocultamos la id para después usarla -->
            <label for="idUser" hidden>Id:</label>
            <input type="hidden" id="idUser" name="idUser" value="<% if (editing) { %><%= user._id %><% } %>">

            <label for="name">Nombre completo:</label>
            <input type="text" id="name" name="name" value="<% if (editing || hasError) { %><%= user.name %><% } %>" class="<%= validationErrors.find(e => e.path === 'name') ? 'invalid' : '' %>" required>
            
            <label for="email">Email :</label>
            <input type="text" id="email" name="email" 
                value="<% if (editing || hasError) { %><%= user.email %><% } %>" 
                class="<%= validationErrors.find(e => e.path === 'email') ? 'invalid' : '' %>"
            >

            <label for="cargo">Cargo / Ocupación:</label>
            <input type="text" id="cargo" name="cargo" value="<% if (editing || hasError) { %><%= user.cargo %><% } %>" class="<%= validationErrors.find(e => e.path === 'cargo') ? 'invalid' : '' %>">

            <label for="descripcion">Descripción:</label>
            <textarea id="descripcion" name="descripcion" rows="5" required><% if (editing || hasError) { %><%= user.descripcion.trim() %><% } %></textarea>

           
            <div id="bloque-lista">
                <label for="publicaciones">Publicaciones:</label>
                <span>Inserta el título de las publicaciones de este miembro. </span>
                <button type="button" onclick="addClick(this, 'publicaciones')" class="button-add" id="ingr-button">
                    <i class="fas fa-plus"></i>
                </button>
                <% if (editing ) { %>
                    <% for (let post of user.posts) { %>
                        <input type="text" name="publicaciones[]" value="<%= post.title %>" class="input-list">
                        <button type="button" onclick="removeClick(this)" class="button-delete" id="ingr-button">-
                            <i class="fas fa-minus"></i>
                        </button>
                    <% } %>
                <% } else { %>
                    <input type="text" name="publicaciones[]" value="" 
                    placeholder="Introduce una publicación" class="input-list">
                <% } %>
            </div>


            <div class="bloque-lista">
                <label for="urlPublicaciones">URL de la publicación:</label>
                <span >
                    Inserta la URL de las publicaciones (asegúrate de que aparecen en el mismo orden que están arriba)
                </span>
                <div id="bloque-lista">
                    <button type="button" onclick="addClick(this, 'urlPublicaciones')" class="button-add" id="ingr-button">
                        <i class="fas fa-plus"></i>
                    </button>
                    <% if (editing ) { %>
                        <% for (let post of user.posts) { %>
                            <input type="text" name="urlPublicaciones[]" value="<%= post.url %>" class="input-list">
                            <button type="button" onclick="removeClick(this)" class="button-delete" id="ingr-button">
                                <i class="fas fa-minus"></i>
                            </button>
                        <% } %>
                    <% } else { %>
                        <input type="text" name="urlPublicaciones[]" value="" 
                        placeholder="Introduce la primera URL" class="input-list">
                    <% } %>
                </div>
            </div>

            <!-- <label for="file">Imagen:</label>
            <input type="file" name="file" id="file"><br><br><br> -->

            <label for="image"> Url de la imagen (preferiblemente URL de imagen linkedin):</label>
            <input type="text" id="image" name="image" 
                value="<% if (editing || hasError) { %><%= user.image %><% } %>" 
                class="<%= validationErrors.find(e => e.path === 'image') ? 'invalid' : '' %>">
            
            <label for="status"> Seleciona el status del miembro:</label>
            <select name="status" id="status">
                <option value="tesista" selected>tesista</option>
                <option value="collab">collab</option>
                <option value="tech">tech</option>
            </select>

            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            
            <% if (editing) { %>
                <input type="submit" value="Actualizar user">
                
            <% } else { %>
                <input type="submit" value="Añadir user">
            <% } %>
        </form>

        <% if (editing) { %>
            <form action="/admin/delete/<%= user._id %>" method="post" style="display:inline">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <input type="submit" value="Borrar user" class="button-delete">
            </form>
        <% } %>
    
    </div>
            
        

    <%- include('../includes/footer') %>

</body>
</html>